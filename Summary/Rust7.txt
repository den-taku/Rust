7章 エラー処理

panicとResultについて説明する

通常のエラー処理
→Resultを用いる
→→プログラムの外部要因に起因する

通常出ないエラー
→パニックで処理される
→→これは起こってはいけない種類のエラー

7.1 パニック

プログラム自身のバグに起因すると思われるバグ
→パニックが生じる
→→プログラマがpanic!()マクロでパニックを直接起こすこともできる

panic発生時
→２つの選択肢

・スタックを巻き戻す←デフォルト
・プロセスをアボートする

7.1.1 スレッドの巻き戻し

panic発生時の流れ

・エラーメッセージが端末に表示される
・スタックが巻き戻される
・最後にスレッドが終了する

RUST_BACKTRACE=1 cargo runと実行すればスタックのダンプも表示される
スタックが巻き戻されるされる時各値は作られたのと逆順にドロップしていく
→詳細は13.1 Dropで ユーザ定義drop関数も呼び出される
パニックを起こしたスレッドがメインスレッドだった場合プロセスが終了(終了コード0)

panicはクラッシュではないし未定義動作でもない
→panicはメモリ安全
→スレッド単位で発生する
→→19章で子スレッドのパニックを親スレッドからうまく扱う方法を示す

スタックの巻き戻しをキャッチしスレッドを殺さずに実行することもできる
→std::panic::catch_unwind()を用いる
(この機能は非Rustのコードから呼び出されるコードで必須→21章で)

catch_unwind()を使ってパニック処理することで頑健なプログラムに
→これらはスタックを巻き戻すパニックだけにしか使えない

7.1.2 アボート

abortするのは次のふた通り
・パニックを起こして巻き戻している最中に.drop()で2つ目のpanicが起きる
・コンパイル時に -C panic=abortと指定する

通常のRustのコードはpanicを処理する義務を負わない
































































































