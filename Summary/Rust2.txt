2章 Rustツアー

いくつかの短いプログラムを通じてRustの安全性・並列性をみる

2.1 Rustのダウンロードとインストール

Rustの管理:rustupを使えば良い

cargo:
コンパイルマネージャ兼パッケージマネージャ
rustc:
コンパイラ
rustdoc:
ドキュメンテーションツール

→普段は全てcargoが実行する

Cargoは適切に整えたパッケージを作る

--bin
→ライブラリでなく実行形式を作る

Cargo.toml:
メタデータを保持
他のライブラリに依存するときはここに書く
→詳しくは8章で

srcサブディレクトリ:
ここに実際のRustのコードを書く

cargo runでビルド・実行
→パッケージ中のどのディレクトリからでも可
→→rustcを起動・実行ファイルをtargetサブディレクトリに配置

cargo clean
→cargoが生成したファイルを消去

2.2 簡単な関数

fnキーワード:関数定義
u64:符号なし64bit整数
→整数型の名前-サイズと符号の有無を表す
→浮動小数点数型:f32、f64 ←IEEE準拠

インデントはspace４つ

変数は値を変更できない
→mutキーワード(mutable)がつくと代入可能

!:マクロ呼び出し(関数呼び出しと区別)

条件式:括弧いらず
制御対象:括弧で囲む必要がある

let:ローカル変数宣言、型推論可能なので、例中では型宣言不要
→関数のボディ内でしか型推論されない

関数のボディがセミコロンなしの変数で終わる
→return文はいらずその式が返り値
→→return文は明示的に早期リターンする時にしか用いない

{}で囲まれたブロックは式扱い

2.3 ユニットテストの記述と実行

テスト機構が言語に組み込まれている
#[test] : test関数 (#[test]マーカーは属性)

cargo test 
→ パッケージ中どこからでもテストを実行可能
→ テスト関数はソースツリーのどこに置いても良い

2.4 コマンドライン引数の処理

use宣言:トレイトをスコープに取り込む(詳細:11章)
トレイト:型が実装できるメソッドの集合みたいなもの

Vec:サイズ可変のベクタ型
→ここではVec<u64>として使っているが推論できるので書かなくて良い

std::env::args → イテレータ(iterator)を返す。最初の値はプログラム名。
→Rustのイテレータは非常に効率的(15章)

OSと連携してI/O
→Result型を返す。Ok(v) or Err(e)
→→Rustは例外機構を持たないのでエラーは全てResultかpanicで処理(7章)

所有権・借用・参照 → 詳しくは4章5章で
→→メモリ管理と安全な並列性の鍵
&演算子:参照を借用
*演算子:参照先の値を返す

main関数が何も返さずに終了
→プログラムの正常終了を意味する
→明示的に値を返した時のみエラーステータスを持って終了する

Rust標準ライブラリの機能
→他にも知りたければRustオンラインドキュメントを参照
→rustup doc --std でプラウザに起動

2.5 簡単なWebサーバ

Rustの利点の１つ:
crates.io(https://crates.io)で公開されている無償ライブラリ群
→cargoから簡単に利用できる

クレート(crate):
Rustのパッケージ。ライブラリ、実行ファイル問わず。

iron(Webフレームワーク)、hyper(HTTPサーバ)等を用いて使い方を学ぶ

[dependencies]:
利用するクレートの名前のバージョンを記入
バージョン管理については8章

&mut: 可変参照
_仮引数名:仮引数を使用しないことをコンパイラに宣言
set_mut:引数の型でどの部分に値を設定するか決定
沢山の""が必要→生文字列(raw string)構文

Rustの宣言
→ネスト関係さえ合っていればどこでも良い　
→→マクロ関係のextern crateは例外

Resultのようにそれぞれ値を保持する異型:
(列挙型)enum、または代数的データ型(algebraic data types)(10章)
→match式を用いて解析できる

2.6 並列プログラミング

データ競合が起きない形でしか複数のスレッドがメモリを共有できない

プログラムがコンパイルできたのなら、データ競合は起きない

複雑な並行実行のパターン　→19章
演算子オーバーロード　　　→12章

ドキュメントコメント(documentation comments)
→/// (詳しくは8章)

構造体のフィールドを初期化
→同名で初期化が多い
→→省略記法が使える

数値型に対して暗黙の変換をすることはない

image crate → ファイルフォーマットのR/W、画像操作を提供
























