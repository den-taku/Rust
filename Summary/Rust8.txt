8章クレートとモジュール

クレートとモジュール
→プログラムを構造化

ドキュメントの書き方、テストの仕方、コンパイラエラー制御、依存関係とバージョン管理、OSLibraryなどなど

8.1 クレート

Rustプログラムはクレートで構成される
→全てのソースコードやテスト、設定やツールなど全てが収められる

ライブラリはクレートとして配布されている
→依存関係を見たければ cargo build --verbose

extern crate ...;
→...が外部ライブラリであることをコンパイラに宣言

[dependencies]
→そのプロジェクトが使うクレートを示す

クレートはcrate.io(http://crate.io/)にある
→個々のクレートのページにはdocやsrcへのリンクと設定行が提供されている

クレートのダウンロード→Cargo.tomlからさらにクレートをダウンロード→全てのクレートをコンパイル

ライブラリのコンパイルには --crate-type libを用いる
→main()関数を探さず.rlibファイルを作る

本体のプログラムのコンパイルには --crate-type binを用いる
→結果はターゲット環境のバイナリ実行ファイル

rustcコマンドを実行する時に--externオプションでライブラリファイル名を指定
→rustcにコンパイル済みクレートの場所を教える
→→.rlibファイルは最終的な実行ファイルに静的にリンクする

cargo buildには様々なオプションがある
→例えば--releaseは最適化するがコンパイルに時間がかかる。少し粗い

8.1.1 ビルドプロファイル

Cargo.tomlファイルの設定でcargoが生成するrustcのコマンドラインを制御できる

-command line-          -section in Cargo.toml-            
cargo build             [profile.dev]
cargo build --release   [profile.release]
cargo test              [profile.test]

プロファイラ:
プログラムのどこでCPU時間を使っているかを測定するツール
→良いデータを取るには最適化を行いデバッグシンボルがつくようにコンパイル
→→ただしこれらはそれぞれリリースビルド、デバッグビルドでしか有効でない
→→→debugはrustcに-gオプションをつけるかどうか制御

様々な設定方法がCargo (http://doc.crates.io/manifest.html)のdocに
































































































