9章 構造体

構造体(struct):
様々な型の複数の値を1つの単位として扱えるように1つの値に組み込んだもの
→構成要素に愛する操作を行うメソッドを関連づけることもできる

Rustには3種類の構造体
・名前付きフィールド型
・タプル型
・ユニット型
→個々の要素にアクセスする方法が異なる

9.1 名前付きフィールド型構造体

名前付きフィールド型構造体の定義式

struct StructName {
    key1: type,
    key2: type,
    ...
}

構造体を含む全ての型の名前はCamelCaseで書く
フィールド名やメソッド名はsnake_caseで書く

この型の値を生成するには次のような構造体式を用いる

let name = StructName {
    key1: value1,
    key2: value2,
    ...
};

省略形(フィールド名と同じ変数や引数を用いて)
StructName { key1, key2, .. .}
→key: value構文と省略形を組み合わせることもできる

module内ではdefaultでprivate
→構造体、各フィールドを外から使うにはpubキーワードをつける
→privateフィールドがあると構造体式で宣言できない

StringやVecは構造体だがフィールドがprivateなので構造体式で宣言できない

省略したフィールドを同じ型の他の構造体を使って指定することもできる
→..式を用いて行う

9.2 タプル型構造体

タプルに似ているのでタプル型構造体と呼ばれる

struct Name(type0, type1, ...)

タプルとの違いは構造体名を与えなければならないということ

要素(element):
タプルまたはタプル型構造体に格納できる値

個々の要素をpublicにもprivateにもできる

型を定義すると関数が自動的に定義される
fn Name(elem0: type0, elem1: type1, ...) -> Name {...}

名前付きフィールド型構造体とタプル型構造体はよく似ている
→読みやすさ・曖昧さ・簡潔さの問題

タプル構造体
→新しい型を作るのに便利(構成要素が1つだけの構造体)
→→効率的な型変換は21章で

9.3 ユニット型構造体

全く要素を宣言しない構造体

struct Name;

ユニット型()と同じようにメモリを消費しない

式..はUnit型構造体RangeFull値の短縮系

Unit型構造体はtraitを扱う際にも役立つ→11章

9.4 構造体のレイアウト

メモリ上では名前付きフィールド型構造体とタプル型構造体は同じ
→ただしフィールドや要素の配置順に規定がない
→構造体のメモリブロックにフィールドの値が直接置かれることは保証されている

#[repr(C)]属性をつければC++と互換性のある配置になる→21章で詳しく

9.5 implによるメソッド定義

任意の独自に定義した構造体に対してメソッドを定義できる
→構造体の外のimplブロック中に書く

implブロックはfnによる関数定義の集合

method
→特定の型に関連づけられているので関連づけられた関数(associated function)とも
→対をなすのは自由関数(free function)

構造体のフィールド
→明示的にselfを使って参照する
→→呼び出し時はメソッド呼び出し機構が暗黙に借用するので省略可能
→→→q.push(...)のように書くだけで(&mut q).push(...)と同じに

selfの所有権を取得したい時
→selfを値で受けることもできる
→もちろん所有権は移動する

スタティックメソッド(static method):
構造体そのものに関連づけられた関数。selfを引数に取らない
→コントラクタ関数などによく用いられる
→→型名::関数名()で参照する

コンストラクタをnew()にするのはRustの慣習

１つの方に対して複数のimplブロックを書くこともできる
→ただし全てのimplブロックは型を定義したのと同一crateに入っていないといけない

独自のメソッドを他の型につけることもできる
→詳しくは「11章 トレイトとジェネリクス」で

型定義とメソッド定義を分ける利点
・型のデータメンバを見つけるのが簡単
・タプル型やユニット型のメソッドも同形式で定義できる(同じ構文を基本型にも用いる)
・impl構文がトレイトの実装でも使える→11章

追記:引数に複数の生存期間が現れる場合でもself仮引数の生存期間を優先






















































































